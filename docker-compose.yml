version: '3.3'
services:
    application:
      container_name: 'service.ipinfo'
      #build: ./src
      # image: '<replace_me>.dkr.ecr.eu-west-1.amazonaws.com/misc/service.ipinfo:1.0.15' #'service.ipinfo:latest'
      image: 'service.ipinfo:latest' #'service.ipinfo:latest'
      ports:
        - 8081:8081
      environment: 
        - ipinfo_access_token=${ipinfo_access_token}
        - LOG_LEVEL=${LOG_LEVEL}
      #command: gunicorn -b 0.0.0.0:81 --access-logfile=- --error-logfile=- --log-level=info application # override dockerfile cmd
      command: gunicorn -b 0.0.0.0:${WSGI_PORT:-8081} --access-logfile=- --error-logfile=- --log-level=${LOG_LEVEL} --timeout=600 --workers=${GUNICORN_WORKERS} --worker-tmp-dir /dev/shm application # override dockerfile cmd and use env var
      logging:
        # driver: "fluentd"
        options:
          # fluentd-address: 192.168.10.80:24225
          labels: service-ipinfo
          tag: service-ipinfo
    redis:
        container_name: 'redis'
        image: redis